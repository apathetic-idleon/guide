---
/* 
This file is part of the Apathetic Guide to IdleOn project.

Apathetic Tools Â© 2025 (https://github.com/apathetic-tools)

This source code is dual-licensed:
 - Under the GNU Affero General Public License v3.0 (AGPLv3).
 - Under alternative licensing terms by the copyright holder.

See `LICENSE-CODE` for details.

SPDX-License-Identifier: AGPL-3.0-or-later
*/

const html = await Astro.slots.render('default');

console.log(html);

// Utility to count occurrences of a tag in the HTML
function countClass(className: string) {
	const regex = new RegExp(`class="[^"]*\\b${className}\\b[^"]*"`, 'g');
	return (html.match(regex) || []).length;
}

const hintCount = countClass('hint-block');
const choiceCount = countClass('choice-block');
const instructCount = countClass('instruct-block');

// Compute promotion classes
const promoteClasses: string[] = [];

if (hintCount > 0) {
	if (choiceCount === 0) {
		promoteClasses.push('promote-hint-to-choice');

		if (instructCount === 0) {
			promoteClasses.push('promote-hint-to-instruct');
		}
	}
}

if (choiceCount > 0 && instructCount === 0) {
	promoteClasses.push('promote-choice-to-instruct');
}
---

<div class={`guide-block ${promoteClasses.join(' ')}`}>
	<slot />
</div>

<style lang="css" scoped></style>
